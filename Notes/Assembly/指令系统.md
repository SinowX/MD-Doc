Intel Syntax x86-32

### 操作数类型

#### 立即数——表征参加操作的数据本身

- 立即数本身是参加操作的数据，可以是8、16、32位的

- 只能作为源操作数

- ```assembly
  MOV AX, 1234H
  MOV BL, 22H
  MOV EDX, 12345678H
  ```

#### 寄存器——表征数据存放的地址

- 参加运算的数放在给出的寄存器中

- ```assembly
  MOV AX, BX
  MOV DL, CH
  MOV ECX, EAX
  ```

#### 存储器——表征数据存放的地址

- 参与运算的数存放在存储器的某个单元中
- 表现形式：`[寄存器/常数]`
- 关键在于确定数据在内存中的存放地址
- <img src="https://i.loli.net/2021/10/12/qDes6GA8pJEkItP.png" alt="image-20210917085349532" style="zoom:50%;" />



## 操作数寻址方式

### 立即寻址

- 源操作数是立即数，是参与操作的数据本身

- ```assembly
  MOV AX, 1200H
  ```

- <img src="https://i.loli.net/2021/10/12/qEaiwYTN4krCR9m.png" alt="image-20210917085646128" style="zoom:50%;" />

- 立即数不能超过目的操作数表示范围

  - 如 MOV AL, 260
  - 其中 AL 表示范围为 0~255

### 寄存器寻址

- 操作数在CPU的通用寄存器或段寄存器中
  - 如 MOV AX, BX

### 直接寻址

- 指令直接给出操作数的偏移地址

- 偏移地址用符号表示（变量）

- 如 MOV AX, VAR1

  - <img src="https://i.loli.net/2021/10/12/eYwuAtvMN72qS4j.png" alt="image-20210917085950611" style="zoom:50%;" />

- 注意

- ```assembly
  MOV AX, [1200H] ;16位模式下，这个为直接寻址，32位模式下，该指令与下一指令等效
  MOV AX, 1200H
  ```



### 寄存器间接寻址

- 参与操作的数据存放在内存中，其偏移地址为指令中的一个32位寄存器的内容

- ```assembly
  MOV EBX, 1200H
  MOV AX, [EBX]
  ;其中EBX装的是偏移地址
  ```

- <img src="https://i.loli.net/2021/10/12/eYwuAtvMN72qS4j.png" alt="image-20210917090450570" style="zoom:50%;" />

- 由寄存器间接给出操作数的偏移地址，存放偏移地址的寄存器称为`间址寄存器`

- 间址寄存器为8个32位通用寄存器

  - EAX、EBX、ECX、EDX、ESI、EDI、EBP、ESP
  - 不能使用16位模式下的4个16位寄存器 BX、BP、SI、DI

- 操作数的段地址取决于选择哪一个间址寄存器

  - EBP、ESP：默认在堆栈段（SS）
  - 其他的寄存器默认段都是在数据段
  - 允许修改默认段寄存器，即段超越

### 寄存器相对寻址

- 操作数的偏移地址为寄存器的内容加上一个位移量（常量）

- 可以使用的寄存器与寄存器间接寻址相同

- ```assembly
  MOV AX, [EBX+DATA]
  MOV AX, [EBX]DATA
  MOV AX, [EBX]+DATA
  MOV AX, [DATA+EBX]
  MOV AX, DATA[EBX]
  MOV AX, DATA+[EBX]
  ```

- 如 MOV EBX, 22H 、MOV CL, [EBX+5]

### 基址-变址寻址

#### 16位模式

- 操作数的偏移地址为

  - 基址寄存器的内容+变址寄存器的内容
  - 基址寄存器的内容+变址寄存器的内容+位移量
  - 基址寄存器：BX、BP
  - 变址寄存器：SI、DI

- 操作数的段地址由选择的基址寄存器决定

  - BX-默认在数据段

  - BP-默认在堆栈段

  - ```assembly
    MOV SI, 2000H
    MOV BX, 200H
    MOV AX, [SI+BX]
    ```

  - <img src="https://i.loli.net/2021/10/12/2Vu51PFtpfnoC6U.png" alt="image-20210917091729424" style="zoom:50%;" />

#### 32位寻址

- 32位变址寄存器乘上一个比例常数2、4、8，从而形成

  - 比例变址寻址方式
  - 基址比例变址寻址方式
  - 基址比例变址位移寻址方式

- <img src="https://i.loli.net/2021/10/12/gKmSvYkUDOTdNxB.png" alt="image-20210917091939505" style="zoom:50%;" />

- ```asm
  MOV EBX, ADDR[ESI*2]	;比例变址寻址方式
  MOV EAX, [EDI*4][EDX]	;基址比例变址寻址方式
  MOV EBX, [EDI*8][EBP+10];基址比例变址位移寻址方式
  ```

### 隐含寻址

- 指令中隐含了一个或两个操作数的地址，即操作数在默认地址中
- 如 MUL BL
  - 表示 AL*BL=>AX



# 80X86指令系统

## 数据传送指令

### 通用数据传送

#### 一般数据传送指令 MOV

- 格式：`MOV dest, src`
- 注意：
  - 两操作数长度必须相同；
  - 存储单元之间不能直接传送；
  - 段寄存器CS只能作源操作数，段寄存器之间不能直接传送；
  - 在源操作数是立即数时，目标操作数不能是段寄存器；
  - 标志寄存器（EFLAGS或FLAGS）一般不作为操作数在指令中出现。
  - MOV指令不影响标志位
  - 可使用Ascii码
    - `MOV AL, '*'` 等价于 `MOV AL, 2AH`
  - <img src="https://i.loli.net/2021/10/12/hxrSvXFs1tgydZT.png" alt="image-20210917092813965" style="zoom:50%;" />
- <img src="https://i.loli.net/2021/10/12/nMxrzdRjVchsog5.png" alt="image-20210917092931929" style="zoom:50%;" />

#### 零扩展与符号扩展传送指令 MOVZX MOVSX

- 将位数短的操作数传到较长的操作数时使用
- MOVZX格式：
  - MOVZX reg32,reg/mem8
  - MOVZX reg32,reg/mem16
  - MOVZX reg16,reg/mem8
- 目的操作数高位用0填充
- 指令将短数传送到长数时将其视为无符号数
- MOVSX格式：
  - MOVSX reg32,reg/mem8
  - MOVSX reg32,reg/mem16
  - MOVSX reg16,reg/mem8
- 目的操作数高位用源操作数的最高位填充
- 指令将短数传送到长数时将其视为有符号数

### 堆栈操作指令

#### 16位模式

- 堆栈操作指令的操作数必为16位
- 不能是立即数；
- 可以是16位寄存器或存储器的1个字单元；
- 若为存储器操作数，需要声明为字存储单元。
- 格式
  - PUSH  OPRD 16位寄存器或
    存储器字单元
  - POP  OPRD 16位寄存器或
    存储器字单元
  - PUSHF 标志寄存器FLAGS进栈指令
  - POPF 标志寄存器FLAGS进栈指令
- 指令的操作数必须是16位；
- 操作数可以是寄存器或存储器字单元，但不能是立即数；
- 不能从栈顶弹出一个字给CS；
- PUSH和POP指令在程序中一般成对出现；
- PUSH指令的操作方向是从高地址向低地址，而POP指令的操作正好相反。

#### 32位模式

- 16位模式下的指令都可以使用，又增加了以下内容

- PUSH允许立即数入栈

  - ```asm
    PUSH 0ABCDH      ;将16位立即数入栈
    PUSH 0ABCD0000H  ;将32位立即数入栈
    ```

- PUSHA：将8个16位通用寄存器按AX、CX、DX、BX、SP、BP、SI与DI的顺序入栈

- PUSHD：将8个32位通用寄存器按EAX、ECX、EDX、EBX、ESP、EBP、ESI与EDI的顺序入栈

- POPA指令从栈顶弹出8个字数据分别送入AX、CX、DX、BX、SP、BP、SI与DI

- POPD指令从栈顶弹出8个双字数据分别送入EAX、ECX、EDX、EBX、ESP、EBP、ESI与EDI

- 新增32位标志寄存器EFLAGS进栈/出栈指令

  - 格式：PUSHFD 或 POPFD

### 交换指令

- 格式 XCHG  REG/MEM，MEM/REG
- 两操作数至少有一个是寄存器操作数
- 不允许使用段寄存器
- 例如
  - XCHG	AX，BX
  - XCHG	[EBP]，CL

## 输入输出指令

- 专门面向IO端口操作的指令

- 指令格式

  - 输入：IN acc, PORT
  - 输出：OUT PORT, acc
  - PORT 为端口地址
  - acc 为累加器， 16位模式下可以是AL 或 AX，32位模式下可以是 EAX

- 直接寻址

  - 端口地址为8位时，指令中的PORT直接由一个8位无符号常数表示
  - 可寻址 256 个端口

- 间接寻址

  - 端口地址超过 255 时，地址码为16位，指令中的端口必须由DX指定
  - 可寻址64K个端口
  - 当端口地址为255时，也可以用DX间接寻址

- 举例

- ```asm
  IN AX, 80H ;从80H端口
  MOV DX. 2400H ;
  IN AL, DX ; 从2400H端口输入一个字节
  OUT 35H, EAX ; 向35H端口输入一个双字数据
  ```

## 取地址偏移指令 LEA

- 操作
  - 将一个存储单元的16位或32位偏移地址取出，送到目标寄存器
- 当程序中用符号地址表示内存偏移地址时，可以使用该指令方便获得偏移地址
- 格式：LEA REG, MEM
- 要求
  - 源操作数必须是一个存储器操作数，目标操作数必须是16位或32位通用寄存器
- <img src="https://i.loli.net/2021/10/12/RNYbhX2PVvzSlcd.png" alt="image-20210918112002784" style="zoom:50%;" />
- 应用场景
  - 将数据段中首地址为MEM1 的50个字节的数据传送到同一逻辑段首地址为MEM2的区域存放。编写相应的程序段 。
  - <img src="https://i.loli.net/2021/10/12/mBGXj5g3aWbf7yz.png" alt="image-20210918112220864" style="zoom:50%;" />

## 标志位操作指令 LAHF/SAHF

### LAHF

- 操作
  - 将FLAGS的低8位装入 AH
  - <img src="https://i.loli.net/2021/10/12/K25AhjadZBLrM3o.png" alt="image-20210918112350028" style="zoom:50%;" />

SAHF

- 操作
  - 将AH装入FLAGS 的低8位



## 算术运算类指令

- 大多会对状态标志位产生影响

### 加法

- 对操作数要求与MOV基本相同
- 分类
  - 普通加法指令 ADD
    - 对全部6个状态标志位都产生影响
  - 带进位的加法指令
    - 指令格式、对操作数的要求、对标志位的影响与ADD指令完全一样
    - 常用于多字节数相加，使用前要先将CF清零
  - 自增1 指令 INC
    - INC OPRD
    - 不影响CF标志
    - 常用于修改地址指针

### 减法指令



