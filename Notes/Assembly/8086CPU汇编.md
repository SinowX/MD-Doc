### 16 位结构的 CPU

#### 结构特性

- 运算器一次最多可以处理 16 位的数据
- 寄存器的最大宽度为 16 位
- 寄存器和运算器之间的通路为 16 位

### 8086 CPU

- 地址总线 20 位， 寻址能力 1MB(操作最小单元为 一个 byte)
- 基础地址(16 位的倍数) + 偏移地址 = 物理地址
- ![image-20210813151018747](/home/sinow/.config/Typora/typora-user-images/image-20210813151018747.png)



### DOSBOX debug 操作





- debug 打开程序时，CS寄存器保存着程序长度，字节为单位
- T 单步跟踪程序，到 int 21 时，用 P 执行
- R 查看、寄存器的值
  - ![image-20210813163150442](/home/sinow/.config/Typora/typora-user-images/image-20210813163150442.png)
- D 查看 内存
  - ![image-20210813163336655](/home/sinow/.config/Typora/typora-user-images/image-20210813163336655.png)
  - ![image-20210813163352417](/home/sinow/.config/Typora/typora-user-images/image-20210813163352417.png)
  - 可用 `d 段寄存器:偏移地址`
    - ![image-20210814153551754](/home/sinow/.config/Typora/typora-user-images/image-20210814153551754.png)
- E 修改 内存
  - ![image-20210813163528254](/home/sinow/.config/Typora/typora-user-images/image-20210813163528254.png)
  - ![image-20210813163541607](/home/sinow/.config/Typora/typora-user-images/image-20210813163541607.png)
  - ![image-20210813163608383](/home/sinow/.config/Typora/typora-user-images/image-20210813163608383.png)
  - ![image-20210813163908781](/home/sinow/.config/Typora/typora-user-images/image-20210813163908781.png)
  - 可用 `e 段寄存器:偏移地址`
- U 查看内存中机器码含义
  - ![image-20210813164113804](/home/sinow/.config/Typora/typora-user-images/image-20210813164113804.png)
  - 可用 `u 段寄存器:偏移地址`
- T 执行 CS:IP 处指令
  - ![image-20210813164439395](/home/sinow/.config/Typora/typora-user-images/image-20210813164439395.png)
  - t 命令执行修改寄存器 SS 的指令时，下一条指令也紧接着被执行
- A 以汇编指令在内存中加入机器指令
  - ![image-20210813164609012](/home/sinow/.config/Typora/typora-user-images/image-20210813164609012.png)
  - 可用 `a 段寄存器:偏移地址`
- P 在遇到loop循环时，使用P可直接循环结束







### 通用寄存器

- AX、BX、CX、DX
- 用来存放一般性数据
- 都是 16 位寄存器
- AX 分为 AH（高8位，8~15位）、AL (低8位，0~7位)
- BX 分为 BH、BL
- CX 分为 CH、CL
- DX 分为 DH、DL

![image-20210813145858867](/home/sinow/.config/Typora/typora-user-images/image-20210813145858867.png)



- 字节 byte 由8个bit 组成
- 字 word 由两个字节组成
- ![image-20210813150308712](/home/sinow/.config/Typora/typora-user-images/image-20210813150308712.png)







| 汇编指令   | sa   |
| ---------- | ---- |
| mov ax, 18 |      |
| mov ah, 78 |      |
| add ax, 8  |      |
| mov ax, bx |      |
| add ax, bx |      |



### 段寄存器

- CS、DS、SS、ES

- CS 代码段寄存器，IP 指令指针寄存器
- mov 指令 不能用于设置 CS、IP 的值，需要使用 jmp指令

| 汇编指令   | 效果               |
| ---------- | ------------------ |
| jmp 2AE3:3 | CS=2AE3H, IP=0003H |
| jmp 3:0B16 | CS=0003H, IP=0B16H |

- 仅修改 IP

| 汇编指令 | 效果                         |
| -------- | ---------------------------- |
|          | ax=1000H, CS=2000H, IP=0003H |
| jmp ax   | ax=1000H, CS=2000H, IP=1000H |
|          | bx=0B16H, CS=2000H, IP=0003H |
| jmp bx   | bx=0B16H, CS=2000H, IP=0B16H |



### 内存单元

- `mov al, [0]`

- `[...]` 表示一个内存单元，其中数字表示内存单元的偏移地址

- 8086CPU 自动取 DS 中的数据作为内存单元的段地址

- `mov al,1`

  - 把数据1送入寄存器

- DS 是一个段寄存器

- 8086CPU 不支持将数据直接送入段寄存器

  - 如 `mov ds,1000H` 是非法的
  - 必须要用一个一般的寄存器中转，如BX，然后将BX送入DS

- 8086CPU 是16位结构，有16根数据线，可一次性传送16位的数据，即一个字

- ```assembly
  mov bx,1000H
  mov ds,bx
  mov ax,[0]
  ; 1000:0 处的字型数据送入 ax
  mov [0],cx
  ; cx 中的16位数据送到 1000:0 处
  ```



### mov 形式

| 指令                   | 举例       |
| ---------------------- | ---------- |
| mov 寄存器，数据       | mov ax,8   |
| mov 寄存器，寄存器     | mov ax,bx  |
| mov 寄存器，内存单元   | mov ax,[0] |
| mov 内存单元，寄存器   | mov [0],ax |
| mov 段寄存器，寄存器   | mov ds,ax  |
| mov 寄存器，段寄存器   | mov ax,ds  |
| mov 内存单元，段寄存器 | mov [0],cs |
| mov 段寄存器，内存单元 | mov cs,[0] |

- 不支持将数据直接送入段寄存器



### add

| 指令                 | 举例       |
| -------------------- | ---------- |
| add 寄存器，数据     | add ax,8   |
| add 寄存器，寄存器   | add ax,bx  |
| add 寄存器，内存单元 | add ax,[0] |
| add 内存单元，寄存器 | add [0],ax |

- 不支持对段寄存器操作

### sub

| 指令                 | 举例       |
| -------------------- | ---------- |
| sub 寄存器，数据     | sub ax,8   |
| sub 寄存器，寄存器   | sub ax,bx  |
| sub 寄存器，内存单元 | sub ax,[0] |
| sub 内存单元，寄存器 | sub [0],ax |

- 不支持对段寄存器操作





### 栈

- SS 段寄存器， SP 寄存器
- 任意时刻，SS:SP 指向站定元素
- 8086 CPU 不保证栈不会超界

| 指令          | 例子 |
| ------------- | ---- |
| push 寄存器   |      |
| push 段寄存器 |      |
| push 内存单元 |      |
| pop 寄存器    |      |
| pop 段寄存器  |      |
| pop 内存单元  |      |





### [BX]

- `mov ax,[bx]`
  - bx 中存放着一个偏移地址EA，段地址SA默认在ds中，将SA:EA 处的数据送入 ax
  - 即 `(ax)=((ds)*16+(bx))`
- `mov [bx],ax`
  - bx 中存放着一个偏移地址EA，段地址SA默认在ds中，将ax中的数据送入 SA:EA
  - 即`((ds)*16+(bx))=(ax)`



### Loop

- 执行loop指令时
  1. (cx)=(cx)-1
  2. 判断 cx 中的值
     - 不为零，则转到标号处执行程序
     - 为零，则向下执行
- 计算 2^12

```assembly
assume cs:code
code segment
	mov ax,2
	
	mov cx,11
s:	add ax,ax
	loop s
	
	mov ax,4c00h
	int 21h
code ends
end
```

