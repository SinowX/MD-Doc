# 链路层

## 有关TCP/IP协议的局域网和城域网IEEE 802标准(2011)

| 名称           | 描述                                                         |
| -------------- | ------------------------------------------------------------ |
| 802.1ak        | 多注册协议 MRP                                               |
| 802.1AE        | MAC安全 MACSec                                               |
| 802.1AX        | 链路聚合 以前的 802.3ad                                      |
| 802.1d         | MAC网桥                                                      |
| 802.1p         | 流量类/优先级/QoS                                            |
| 802.1q         | 虚拟网桥的局域网/MRP的更正                                   |
| 802.1s         | 多生成树协议 MSTP                                            |
| 802.1w         | 快速生成树协议 RSTP                                          |
| 802.1X         | 基于端口的网络访问控制 PNAC                                  |
| 802.2          | 逻辑链路控制 LLC                                             |
| 802.3          | 基本以太网和 10Mb/s 以太网                                   |
| 802.3u         | 100Mb/s 以太网，快速以太网                                   |
| 802.3x         | 全双工运行和流量控制                                         |
| 802.3z/802.3ab | 1000Mb/s 以太网，千兆以太网                                  |
| 802.3ae        | 10Gb/s 以太网，万兆以太网                                    |
| 802.3ad        | 链路聚合                                                     |
| 802.3af        | 以太网供电 PoE 15.4W                                         |
| 802.3ah        | 以太网接入 第一公里以太网                                    |
| 802.3as        | 帧格式扩展 2000bytes                                         |
| 802.3at        | 以太网供电增强 PoE+ 30W                                      |
| 802.3ba        | 40/100Gb/s 以太网                                            |
| 802.11a        | 运行在 5GHz 的 54Mb/s 的无线局域网                           |
| 802.11b        | 运行在 2.4GHz 的 11Mb/s 的无线局域网                         |
| 802.11e        | 针对 802.11的QoS增强                                         |
| 802.11g        | 运行在 2.4GHz 的 54Mb/s 的无线局域网                         |
| 802.11h        | 频谱/电源管理扩展                                            |
| 802.11i        | 安全增强/代替WEP                                             |
| 802.11j        | 运行在 4.9 ~ 5.0Hz                                           |
| 802.11n        | 运行在 2.4GHz 和 5GHz 的 6.5 ~ 600Mb/s 的无线局域网，使用可选的MIMO和40MHz信道 |
| 802.11s        | （草案）网状网，拥塞控制                                     |
| 802.11y        | 运行在3.7GHz的54Mb/s 的无线局域网                            |
| 802.16         | 微博存取全球互通技术WiMAX                                    |
| 802.16d        | 固定的无线城域网标准WiMAX                                    |
| 802.16e        | 固定/移动的无线城域网标准WiMAX                               |
| 802.16h        | 改进的共存机制                                               |
| 802.16j        | 802.16中的多跳机制                                           |
| 802.16k        | 802.16网桥                                                   |
| 802.21         | 介质无关切换                                                 |



## 以太网

- 所有以太网（802.3）帧都基于一个共同的格式，在原有规范的基础上，帧格式已被改进以支持额外功能
- <img src="https://i.loli.net/2021/10/12/fe4vkYrlOS3uaIm.png" alt="image-20210904135603910" style="zoom:50%;" />
  - 前导字段
    - 接收器电路用它来确定一个帧的到达时间，并确定编码位（时钟恢复）之间的时间量
    - 以太网是一个异步的局域网，每个以太网接口卡中不保持精确地时钟同步，从一个接口到另一个接口的编码位之间的间隔可能不同
    - 前导是一个公认的模式，典型值为0xAA，在发现 帧起始分隔符 SFD 时，接收器使用其恢复时钟
    - SFD固定值为0xAB
  - DST 目的地址，SRC 源地址
  - 一个重载的长度/类型字段
  - 一个数据字段
  - 一个帧校验序列CRC32
  - 基本帧格式提供了一个标签，其中包含了一个 VLAN ID 和优先级信息（802.1p/q），以及一个最近出现的可扩展标签
  - 前导和SFD 用于接收器同步
  - 当以太网以半双工模式运行在100Mb/s 或 以上速率时，其他位可能被作为载体扩展添加到短帧中，以确保冲突检测电路的正常运行
- 基本帧格式包括 48位的 DST 和 SRC，有时称为 MAC地址、链路层地址、802地址、硬件地址、物理地址
- 以太网帧的目的地址也允许寻址到多个站点
  - 广播ARP
  - 组播ICMPv6
    - 实现网络层地址和链路层地址之间的转换
- 源地址后紧跟着一个类型字段或一个长度字段
  - 多数情况下，用于确定头部后面的数据类型
  - TCP/IP网络使用的常见值包括 IPv4（0x0800）、IPv6（0x86DD）和 ARP（0x0806）
  - 0x8100 表示一个 Q标签帧，可携带一个虚拟局域网或802.1q标准的VLAN ID
- 以太网帧的基本大小为1518字节，最近的标准将该值扩大到2000字节
- 帧的数据区或有效载荷部分，是放高层PDU（如IP数据报）的地方
  - 传统上，以太网的有效载荷一直是1500字节，代表以太网的MTU
  - 必要时，也可以将有效载荷设置为较小的值
  - 有效载荷有时被填充数个0，以确保帧总体长度符合最小长度要求



#### 帧大小

- 以太网最小帧是64字节，要求数据区（有效载荷）长度（无标签）最小48字节
  - 当有效载荷较小时，填充字节0到有效载荷尾部，确保达到最小长度
- 传统以太网最大帧长度是1518字节，包括4个字节CRC和14字节头部
  - 如果一个帧中包括一个错误，接收不到正确的CRC校验，只需重发1.5KB以修复

- 由多个以太网帧构成一个更大的上层PDU的后果是
  - 每个帧都有一个固定的开销（14字节的头部和4字节的CRC）
  - 为了允许以太网硬件接收电路正确恢复来自网络的数据，并为其他站提供将自己的流量与已有流量区分开的机会，以太网帧在网络中不能无缝压缩在一起



### 虚拟局域网 VLAN

- VLAN在802.1q 标准中
- 兼容的以太网交换机将主机之间的流量分隔为常见的VLAN
- 连在同一交换机但不在同一VLAN中的两台主机，之间的流量需要由一台路由器来传递
- 通过端口分配VLAN
  - 交换机端口所连接的站被分配在一个特定VLAN中，这样连接的任意站就都称为VLAN中的成员
- 基于MAC地址的VLAN
  - 以太网交换机使用表，将一个站的MAC地址映射到一个VLAN
- 也可用IP地址作为分配VLAN的基础



## 网桥和交换机

- 802.1d 标准规定了网桥的操作
- 交换机本质上是高性能的网桥
- 网桥或交换机用于连接多个物理的链路层网络或组成的站
  - <img src="https://i.loli.net/2021/10/12/ybB1iTlJNHpfAzo.png" alt="image-20210904202509775" style="zoom:50%;" />
  - 交换机A、B互联形成一个扩展的局域网
  - 图中，客户端及其连接到A，服务器连接到B
  - 每个网络单元包括交换机都有MAC地址，每个网桥经过一段时间对域外MAC地址的学习后，最终每个交换机都知道了每个站可从哪个端口到达
- 第一次打开交换机或网桥时，其数据库是空的，除了自己之外，不知道任何站的位置
  - 每当接收到一个目的地址不是自己的帧之后，它为除该帧到达的端口之外的所有端口做了一个备份，并向所有端口发送这个帧的备份
  - 如果交换机未学习到站的位置，每个帧将会被交付到每个网段，这样会导致不必要的开销
  - 学习能力可显著降低开销





## 无线局域网——IEEE 802.11 Wi-Fi

### 802.11 帧

- 常见帧格式和最大尺寸的数据帧

- <img src="https://i.loli.net/2021/10/12/UEfVCnmMK1PD2ZT.png" alt="image-20210904204403880" style="zoom:50%;" />
  - 前导码
    - 用于同步，取决于正在使用的802.11协议类型
  - 物理层汇聚程序PLCP 头部
    - 以独立于物理层的方式提供特定的物理层信息
    - PLCP部分的传输速率通常比其余部分低
      - 提高正确交付的概率
      - 提供对传统设备的兼容性和防止慢速操作的干扰
  - MAC PDU 与以太网相似，但是有一些额外的字段
    - 以帧控制字开始，其中包括2位的类型字段，用于识别该帧的类型
      - 管理帧、控制帧、数据帧
      - 每种类型有不同的子类型，剩余的字段由帧类型决定

#### 管理帧

- 用于创建、维持、终止站和接入点之间的连接
  - 也被用于确定是否采用加密
  - 传输网络名称 SSID 或 ESSID
  - 采用的时间数据库等
- 当WiFi接口扫描临近接入点时，这些帧用于提供必要的信息



#### 控制帧 RTS/CTS 和 ACK

- 控制帧与帧确认被用于一种流量控制方式
- 帧确认有助于发送方知道哪些帧已明确发送
- 这些概念也适用于传输层的 TCP 协议
- RTS/CTS 启用时, 一个站在发送数据帧之前发送一个RTS帧, 当接收方愿意接收额外的流量时, 它会响应一个CTS 帧。
- 在 RTS/CTS 交换后，这个站开启一个时间窗口，在CTS帧中标识，用于向确认接受的站发送数据帧
- RTS/CTS 交换有助于避免隐藏终端的问题，通过允许发送时对每个站加以知道，以便发现对方站同时进行的传输
- 由于RTS 和CTS 帧比较短, 因此它们不会长期使用信道
- 如果一个分组的大小足够大,  AP 通常为每个分组启动一次RTS/CTS 交换。
  - 在通常情况下,  AP提供一个称为分组大小闽值( 或类似) 的配置选项。、超过阑值的帧将会导致一个RTS 帧优先于数据帧发送。
  - 如果需要执行RTS/CTS 交换, 大多数设备生产商设置的默认值为500 字节。



## 点到点协议 PPP

