## 系统调用错误

- 每个系统调用手册页记录了调用可能返回值

- 通常`-1`表示出错

- 系统调用检查示例

  - ```c
    fd=open(pathname, flags, mode); // Sys Call to Open a File
    if (fd == -1){
        /*Code Handle Error*/
    }
    ...
    if (close(fd) == -1){
        /*Code Handle Error*/
    }
    ```

- 系统调用失败时，全局整形变量 `errno`设置为一个正值，标识具体错误 `<errno.h>`

  - ```c
    cnt = read(fd,buf,numbytes);
    if (cnt == -1){
        if (errno == EINTR)
            fprintf(stderr, "read was interrupted by a signal\n");
        else{
            /*其他错误*/
        }
    }
    ```

  - 注意：

    - 系统调用、库函数成功，`errno`不会重置为0
    - 进行错误检查时，必须首先检查函数返回值是否表明调用出错，再检查`errno`确定错误原因
    - 少数系统调用，如`getpriority()`，在调用成功后也会返回`-1`
      - 判断此类系统调用是否发生错误，应在调用前将`errno`重置为0,并在调用后进行检查

  - 打印错误消息

    - perror()

      - 打印 msg 字符串，紧跟一条与当前errno值相对应的消息

      - ```c
        #include<stdio.h>
        void perror(const cahr *msg);
        ```

      - ```c
        fd = open(pathname,flags,mode);
        if (fd == -1){
            perror("open");
            exit(EXIT_FAILURE);
        }
        ```

    - strerror()

      - 根据对应的 errnum 中的错误号，返回相应的错误字符串

      - ```c
        #include<string.h>
        char *strerror(int errnum);
        ```

      - `strerror()`返回的字符串是静态分配的，后续调用`strerror()`会覆盖该字符串

      - 若无法识别errnum错误编号，则会返回 "Unknown error nnn." 或NULL

## 库函数错误

- 不同库函数调用错误，返回的数据类型和值各不相同
- 可分为：
  - 返回值为 -1，errno 号表示错误，如remove()
  - 返回值为 -1 以外的值，errno 号表示错误，如fopen() 返回NULL
  - 不使用 errno 号，确定错误存在与否及起因的方法，应根据相应函数手册
  - 

